---
title: Google Chronicle Malware Challenge
date: 2024-03-26 12:00:00 -500
categories: [SIEM,SIEM]
tags: [Chronicle,Detection,SIEM,Chronicle]

---

> [!quote] It is important to our friends to believe that we are unreservedly frank with them, and important to friendship that we are not.
> — Mignon McLaughlin

---

## Google Chronicle Malware Challenge

It's time to investigate the IOC domain sipapals[.]servehalflife[.]com.

The site appears to have associated threat intel coming from Mandiant. The graph view shows us beaconing like activity. 

![Pasted image 20240326103017.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326103017.png)

![Pasted image 20240326103137.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326103137.png)

Can spot historical data in the Domain View. 
![Pasted image 20240326103108.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326103108.png)

Drill into Asset view to view all events for this host. 

Prevalence indicates whether IOA/IOC's activity is present/ongoing and how often it is occurring. The IOC activity is low/rarely seen it is of more interest. 

The **Low Prevalence Domains** and **Domains New to the Enterprise** tiles display the most interesting domains contained in the graph.

Adjust the events slider 

![Pasted image 20240326105039.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326105039.png)

Couldn't seem to get the Prevalence slider to adjust. 

The lab is not current from this point forward where it references the
`www[.]office-revision[.]com`  site.

Up the prevalence domains listed if possible. 

![Pasted image 20240326111647.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326111647.png)

Drill into the other domains
![Pasted image 20240326111729.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326111729.png)

Drill into the raw logs for this net connect we can see There were 4 events from 3 sources, DNS, EDR and Web Proxy.

![Pasted image 20240326111815.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326111815.png)

You can see current processes running for a connection.

![Pasted image 20240326111956.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326111956.png)

Filter the process by selecting the O button next to svchest.exe Process Name. 
![Pasted image 20240326112119.png](https://raw.githubusercontent.com/Xp101T7/Xp101T7.github.io/main/images/Pasted%20image%2020240326112119.png)

Look into the **filemod_lastwrite** event and you can see that svchest.exe wrote to notepab.exe. 

Check for persistence on the machine, review raw logs for regmod_createkey events to explore more. 

## Persistence - Registry Modification 

NOTE: (About Reg Modification)
Malware often attempts to persist on an infected system by modifying registry entries for several reasons:

1. Autostart: By modifying specific registry keys, such as those under "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run" or "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run", the malware can ensure that it automatically starts each time the system boots up. This allows the malware to maintain its presence and continue its malicious activities even after a system restart.

2. Stealth: Malware may modify registry entries to hide its presence and evade detection by security software. For example, it might alter registry keys related to security settings, disable antivirus programs, or create entries that disguise the malware as a legitimate process.

3. System configuration: Registry entries store important system configurations and settings. Malware may modify these entries to change the behavior of the operating system or applications in a way that benefits the malware's objectives. This could include disabling security features, changing network settings, or modifying file associations.

4. Persistence mechanism: The registry is a common and reliable method for malware to achieve persistence because it is a critical component of the Windows operating system. By embedding itself in the registry, the malware can ensure that it remains active and survives various system events, such as user logouts, system restarts, or application terminations.

5. Difficulty of removal: Modifying registry entries can make it more challenging to remove the malware completely. Even if the malware's executable files are deleted, the registry entries may still exist, allowing the malware to re-download itself or continue functioning. This is why thorough cleaning of registry entries is crucial during malware removal.

6. Flexibility: The registry provides a flexible and extensible way for malware to store configuration data, command and control information, or other settings specific to the malware's functionality. By utilizing registry entries, malware can adapt its behavior based on the stored data and operate dynamically based on the infected system's environment.

The malware modified the registry (windows\\currentversion\\run\\kris) to persist across reboots.  You can trace the PID and hopefully use EDR or Process Hacker from sysinternals to locate and destroy the sample. Also remember that malware can check itself for deletion so it may persist by the original running process, so you can always disable the file via the registry and not delete it as very few malware dev's runs checks for this. Then you can trace the origin of the malware and remove it all. 










